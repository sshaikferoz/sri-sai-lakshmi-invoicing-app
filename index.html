<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .invoice-preview {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            .printable-invoice * {
                visibility: visible;
            }

            .printable-invoice {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const InvoiceGenerator = () => {
            const [mode, setMode] = useState('form'); // 'form' or 'pdf'
            const [formData, setFormData] = useState({
                companyName: 'SRI SAI LAKSHMI ENTERPRISES',
                address: '4-77, Elikatta Village, Farooqnagar Mandal,Ranga Reddy Dist, Telangana, 509216',
                mobile: '9573391321',
                email: 'sslenterprises1988@gmail.com',
                gstn: '36CJTPP4170J1ZJ',
                placeOfService: 'Ellikatta (V), Farooqnagar (M), R R Dist,Telangana-509216',
                stateCode: '36',
                invoiceNo: 'SSLE-05',
                date: '31-08-2025',
                receiverName: 'M/s.Sree Jayalakshmi Minerals.,',
                receiverAddress: '8-3-315/9A,2nd Floor, Maruthinagar,',
                receiverCity: 'Yousufguda,Hyderabad-500045,',
                receiverState: 'Telangana,India.',
                customerGST: '36ACHFS4911P1ZL',
                bankName: 'SRI SAI LAKSHMI ENTERPRISES',
                accountNo: '50200054088341',
                bankBranch: 'HDFC Bank , Branch Name: Shadnagar',
                ifscCode: 'HDFC0004330',
                items: [
                    // { description: 'Labour Charges for Quartz Lumps -Nava', sacCode: '998622', qty: '0.000', rate: '0' },
                ]
            });

            // Calculate amounts automatically
            const calculateAmounts = () => {
                let totalBeforeTax = 0;
                const calculatedItems = formData.items.map(item => {
                    const qty = parseFloat(item.qty) || 0;
                    const rate = parseFloat(item.rate) || 0;
                    const amount = qty * rate;
                    totalBeforeTax += amount;
                    return {
                        ...item,
                        amount: amount === 0 ? '-' : amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
                    };
                });

                const igst = totalBeforeTax * 0.18; // 18% IGST
                const totalAfterTax = totalBeforeTax + igst;

                return {
                    items: calculatedItems,
                    totalBeforeTax: totalBeforeTax.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    igst: igst.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    totalAfterTax: totalAfterTax.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    netAmount: totalAfterTax.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    amountInWords: numberToWords(Math.round(totalAfterTax))
                };
            };

            // Convert number to words
            const numberToWords = (num) => {
                const ones = ['', 'ONE', 'TWO', 'THREE', 'FOUR', 'FIVE', 'SIX', 'SEVEN', 'EIGHT', 'NINE'];
                const tens = ['', '', 'TWENTY', 'THIRTY', 'FORTY', 'FIFTY', 'SIXTY', 'SEVENTY', 'EIGHTY', 'NINETY'];
                const teens = ['TEN', 'ELEVEN', 'TWELVE', 'THIRTEEN', 'FOURTEEN', 'FIFTEEN', 'SIXTEEN', 'SEVENTEEN', 'EIGHTEEN', 'NINETEEN'];

                if (num === 0) return 'ZERO RUPEES ONLY';

                let result = '';

                // Crores
                if (num >= 10000000) {
                    const crores = Math.floor(num / 10000000);
                    result += convertHundreds(crores) + ' CRORE ';
                    num %= 10000000;
                }

                // Lakhs
                if (num >= 100000) {
                    const lakhs = Math.floor(num / 100000);
                    result += convertHundreds(lakhs) + ' LAKH ';
                    num %= 100000;
                }

                // Thousands
                if (num >= 1000) {
                    const thousands = Math.floor(num / 1000);
                    result += convertHundreds(thousands) + ' THOUSAND ';
                    num %= 1000;
                }

                // Hundreds
                if (num >= 100) {
                    const hundreds = Math.floor(num / 100);
                    result += ones[hundreds] + ' HUNDRED ';
                    num %= 100;
                }

                // Tens and ones
                if (num >= 20) {
                    const tensDigit = Math.floor(num / 10);
                    result += tens[tensDigit] + ' ';
                    num %= 10;
                }

                if (num >= 10 && num < 20) {
                    result += teens[num - 10] + ' ';
                } else if (num > 0) {
                    result += ones[num] + ' ';
                }

                function convertHundreds(n) {
                    let str = '';
                    if (n >= 100) {
                        str += ones[Math.floor(n / 100)] + ' HUNDRED ';
                        n %= 100;
                    }
                    if (n >= 20) {
                        str += tens[Math.floor(n / 10)] + ' ';
                        n %= 10;
                    }
                    if (n >= 10 && n < 20) {
                        str += teens[n - 10] + ' ';
                    } else if (n > 0) {
                        str += ones[n] + ' ';
                    }
                    return str.trim();
                }

                return result.trim() + ' RUPEES ONLY';
            };

            // Check for URL parameters on component mount
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const invoiceData = urlParams.get('data');

                if (invoiceData) {
                    try {
                        const decodedData = JSON.parse(decodeURIComponent(invoiceData));
                        setFormData(decodedData);
                        setMode('pdf');
                        // Auto-generate PDF after a short delay to ensure the page loads properly
                        setTimeout(() => {
                            generatePDFDirect();
                        }, 500);
                    } catch (error) {
                        console.error('Error parsing URL parameters:', error);
                        setMode('form');
                    }
                } else {
                    setMode('form');
                }
            }, []);

            const handleInputChange = (e, index = null, field = null) => {
                if (index !== null && field) {
                    const newItems = [...formData.items];
                    newItems[index][field] = e.target.value;
                    setFormData({ ...formData, items: newItems });
                } else {
                    setFormData({ ...formData, [e.target.name]: e.target.value });
                }
            };

            const addItem = () => {
                setFormData({
                    ...formData,
                    items: [...formData.items, { description: '', sacCode: '998622', qty: '', rate: '' }]
                });
            };

            const removeItem = (index) => {
                const newItems = formData.items.filter((_, i) => i !== index);
                setFormData({ ...formData, items: newItems });
            };

            const generatePDFWithURL = async () => {
                // Get button reference and show loading state
                const button = document.querySelector('.w-full.bg-blue-600'); // More specific selector
                const originalText = button.textContent;
                button.textContent = 'Generating PDF...';
                button.disabled = true;
                button.classList.add('opacity-75', 'cursor-not-allowed');

                try {
                    // Calculate amounts before generating PDF
                    const calculations = calculateAmounts();
                    const updatedFormData = { ...formData, ...calculations };

                    // Create the URL with encoded data (using vercel.app domain as specified)
                    const encodedData = encodeURIComponent(JSON.stringify(updatedFormData));
                    const invoiceUrl = `https://sri-sai-lakshmi-invoicing-app.vercel.app/?data=${encodedData}`;

                    // Send request to PDF generation API
                    const response = await fetch('https://pdf-generator-latest-1.onrender.com/api/pdf/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            url: invoiceUrl
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    // Get the PDF blob from the response
                    const pdfBlob = await response.blob();

                    // Create download link
                    const downloadUrl = window.URL.createObjectURL(pdfBlob);
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = `tax-invoice-${formData.invoiceNo || 'new'}.pdf`;

                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Clean up the blob URL
                    window.URL.revokeObjectURL(downloadUrl);

                } catch (error) {
                    console.error('PDF Generation Error:', error);
                    alert(`Failed to generate PDF: ${error.message}`);

                    // Fallback: open preview in new tab
                    const calculations = calculateAmounts();
                    const updatedFormData = { ...formData, ...calculations };
                    const encodedData = encodeURIComponent(JSON.stringify(updatedFormData));
                    const currentUrl = window.location.href.split('?')[0];
                    const newUrl = `${currentUrl}?data=${encodedData}`;
                    window.open(newUrl, '_blank');
                } finally {
                    // Reset button state (this runs whether success or error)
                    button.textContent = originalText;
                    button.disabled = false;
                    button.classList.remove('opacity-75', 'cursor-not-allowed');
                }
            };

            const generatePDFDirect = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Set font
                doc.setFont('helvetica');

                // Header - TAX INVOICE
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('TAX INVOICE', 105, 20, { align: 'center' });
                doc.rect(20, 12, 170, 12);

                // Company Name
                doc.setFontSize(14);
                doc.text(formData.companyName, 105, 35, { align: 'center' });
                doc.rect(20, 24, 170, 12);

                // Company Details
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.text(`Address : ${formData.address}`, 25, 45);
                doc.text(`Mobile No: ${formData.mobile}  ; e-mail: ${formData.email}`, 25, 52);
                doc.text(`Our GSTN : ${formData.gstn}`, 25, 59);
                doc.text(`Place of Service : ${formData.placeOfService}`, 25, 66);
                doc.text(`State Code : ${formData.stateCode}`, 25, 73);

                // Invoice Details Header
                doc.rect(20, 80, 130, 8);
                doc.rect(150, 80, 20, 8);
                doc.rect(170, 80, 20, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Details of Receiver (Billed to)', 25, 86);
                doc.text('Invoice No :', 155, 86);
                doc.text('Date :', 175, 86);

                // Invoice Details Values
                doc.rect(20, 88, 130, 8);
                doc.rect(150, 88, 20, 8);
                doc.rect(170, 88, 20, 8);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.invoiceNo, 155, 94);
                doc.text(formData.date, 175, 94);

                // Receiver Details
                let yPos = 100;
                doc.text(formData.receiverName, 25, yPos);
                doc.text(formData.receiverAddress, 25, yPos + 7);
                doc.text(formData.receiverCity, 25, yPos + 14);
                doc.text(formData.receiverState, 25, yPos + 21);
                doc.text(`Customers GST No. ${formData.customerGST}`, 25, yPos + 28);

                doc.rect(20, 96, 130, 32);
                doc.rect(150, 96, 40, 32);
                doc.setFont('helvetica', 'bold');
                doc.text('State Code', 155, yPos + 10);
                doc.text(formData.stateCode, 165, yPos + 18);

                // Items Table Header
                yPos = 135;
                doc.rect(20, yPos, 15, 8);
                doc.rect(35, yPos, 80, 8);
                doc.rect(115, yPos, 20, 8);
                doc.rect(135, yPos, 15, 8);
                doc.rect(150, yPos, 20, 8);
                doc.rect(170, yPos, 20, 8);

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.text('S.No', 27, yPos + 5);
                doc.text('Description of Service', 75, yPos + 5, { align: 'center' });
                doc.text('SAC Code', 125, yPos + 5, { align: 'center' });
                doc.text('Qty', 140, yPos + 3);
                doc.text('M.tons', 140, yPos + 6);
                doc.text('Price per', 160, yPos + 3);
                doc.text('M.ton Rs.', 160, yPos + 6);
                doc.text('Amount', 180, yPos + 3, { align: 'center' });
                doc.text('Rs.', 180, yPos + 6, { align: 'center' });

                // Calculate amounts
                const calculations = calculateAmounts();

                // Items
                doc.setFont('helvetica', 'normal');
                yPos += 8;
                calculations.items.forEach((item, index) => {
                    doc.rect(20, yPos, 15, 8);
                    doc.rect(35, yPos, 80, 8);
                    doc.rect(115, yPos, 20, 8);
                    doc.rect(135, yPos, 15, 8);
                    doc.rect(150, yPos, 20, 8);
                    doc.rect(170, yPos, 20, 8);

                    doc.text((index + 1).toString(), 27, yPos + 5);
                    doc.text(item.description, 37, yPos + 5);
                    doc.text(item.sacCode, 125, yPos + 5, { align: 'center' });
                    doc.text(item.qty, 147, yPos + 5, { align: 'right' });
                    doc.text(item.rate, 167, yPos + 5, { align: 'right' });
                    doc.text(item.amount, 187, yPos + 5, { align: 'right' });
                    yPos += 8;
                });

                // Total Before Tax
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Total Amount before Tax', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.totalBeforeTax, 187, yPos + 5, { align: 'right' });

                // Bank Details and Tax Section
                yPos += 8;
                doc.rect(20, yPos, 95, 32);
                doc.rect(115, yPos, 35, 8);
                doc.rect(150, yPos, 20, 8);
                doc.rect(170, yPos, 20, 8);

                doc.setFont('helvetica', 'bold');
                doc.text('Our Bank Details:', 25, yPos + 5);
                doc.text('Add : IGST @', 132, yPos + 5, { align: 'center' });
                doc.text('18%', 160, yPos + 5, { align: 'center' });
                doc.text(calculations.igst, 187, yPos + 5, { align: 'right' });

                yPos += 8;
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.setFont('helvetica', 'normal');
                doc.text(`Name : ${formData.bankName}`, 25, yPos + 5);
                doc.setFont('helvetica', 'bold');
                doc.text('Total Amount after Tax:', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.totalAfterTax, 187, yPos + 5, { align: 'right' });

                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.text(`A/c.No. ${formData.accountNo}`, 25, yPos + 5);

                yPos += 8;
                doc.text(`Bank Name: ${formData.bankBranch}`, 25, yPos + 5);

                yPos += 8;
                doc.rect(20, yPos, 95, 8);
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.text(`IFSC Code: ${formData.ifscCode}`, 25, yPos + 5);
                doc.setFont('helvetica', 'bold');
                doc.text('Net Amount Payable', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.netAmount, 187, yPos + 5, { align: 'right' });

                // Amount in Words
                yPos += 15;
                doc.setFont('helvetica', 'normal');
                doc.text(`Rupees : ${calculations.amountInWords}`, 25, yPos);

                // Declaration and Signature
                yPos += 25;
                doc.rect(20, yPos, 120, 25);
                doc.rect(140, yPos, 50, 25);
                doc.setFont('helvetica', 'bold');
                doc.text('Subject to Hyderabad Jurisdiction Only', 25, yPos + 5);
                doc.text('Declaration:', 25, yPos + 10);
                doc.text(`For ${formData.companyName}`, 165, yPos + 5, { align: 'center' });
                doc.text('Authorised Signatory', 165, yPos + 15, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.text('We declare that this invoice shows the actual price of the', 25, yPos + 15);
                doc.text('goods described and that all particulars are true and correct.', 25, yPos + 20);

                // Open PDF in current window
                const pdfDataUri = doc.output('datauristring');
                const newWindow = window.open();
                newWindow.document.write(`<iframe width='100%' height='100%' src='${pdfDataUri}'></iframe>`);
            };

            const downloadPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Calculate amounts
                const calculations = calculateAmounts();

                // Set font
                doc.setFont('helvetica');

                // Header - TAX INVOICE
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('TAX INVOICE', 105, 20, { align: 'center' });
                doc.rect(20, 12, 170, 12);

                // Company Name
                doc.setFontSize(14);
                doc.text(formData.companyName, 105, 35, { align: 'center' });
                doc.rect(20, 24, 170, 12);

                // Company Details
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.text(`Address : ${formData.address}`, 25, 45);
                doc.text(`Mobile No: ${formData.mobile}  ; e-mail: ${formData.email}`, 25, 52);
                doc.text(`Our GSTN : ${formData.gstn}`, 25, 59);
                doc.text(`Place of Service : ${formData.placeOfService}`, 25, 66);
                doc.text(`State Code : ${formData.stateCode}`, 25, 73);

                // Invoice Details Header
                doc.rect(20, 80, 130, 8);
                doc.rect(150, 80, 20, 8);
                doc.rect(170, 80, 20, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Details of Receiver (Billed to)', 25, 86);
                doc.text('Invoice No :', 155, 86);
                doc.text('Date :', 175, 86);

                // Invoice Details Values
                doc.rect(20, 88, 130, 8);
                doc.rect(150, 88, 20, 8);
                doc.rect(170, 88, 20, 8);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.invoiceNo, 155, 94);
                doc.text(formData.date, 175, 94);

                // Receiver Details
                let yPos = 100;
                doc.text(formData.receiverName, 25, yPos);
                doc.text(formData.receiverAddress, 25, yPos + 7);
                doc.text(formData.receiverCity, 25, yPos + 14);
                doc.text(formData.receiverState, 25, yPos + 21);
                doc.text(`Customers GST No. ${formData.customerGST}`, 25, yPos + 28);

                doc.rect(20, 96, 130, 32);
                doc.rect(150, 96, 40, 32);
                doc.setFont('helvetica', 'bold');
                doc.text('State Code', 155, yPos + 10);
                doc.text(formData.stateCode, 165, yPos + 18);

                // Items Table Header
                yPos = 135;
                doc.rect(20, yPos, 15, 8);
                doc.rect(35, yPos, 80, 8);
                doc.rect(115, yPos, 20, 8);
                doc.rect(135, yPos, 15, 8);
                doc.rect(150, yPos, 20, 8);
                doc.rect(170, yPos, 20, 8);

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.text('S.No', 27, yPos + 5);
                doc.text('Description of Service', 75, yPos + 5, { align: 'center' });
                doc.text('SAC Code', 125, yPos + 5, { align: 'center' });
                doc.text('Qty', 140, yPos + 3);
                doc.text('M.tons', 140, yPos + 6);
                doc.text('Price per', 160, yPos + 3);
                doc.text('M.ton Rs.', 160, yPos + 6);
                doc.text('Amount', 180, yPos + 3, { align: 'center' });
                doc.text('Rs.', 180, yPos + 6, { align: 'center' });

                // Items
                doc.setFont('helvetica', 'normal');
                yPos += 8;
                calculations.items.forEach((item, index) => {
                    doc.rect(20, yPos, 15, 8);
                    doc.rect(35, yPos, 80, 8);
                    doc.rect(115, yPos, 20, 8);
                    doc.rect(135, yPos, 15, 8);
                    doc.rect(150, yPos, 20, 8);
                    doc.rect(170, yPos, 20, 8);

                    doc.text((index + 1).toString(), 27, yPos + 5);
                    doc.text(item.description, 37, yPos + 5);
                    doc.text(item.sacCode, 125, yPos + 5, { align: 'center' });
                    doc.text(item.qty, 147, yPos + 5, { align: 'right' });
                    doc.text(item.rate, 167, yPos + 5, { align: 'right' });
                    doc.text(item.amount, 187, yPos + 5, { align: 'right' });
                    yPos += 8;
                });

                // Total Before Tax
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Total Amount before Tax', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.totalBeforeTax, 187, yPos + 5, { align: 'right' });

                // Bank Details and Tax Section
                yPos += 8;
                doc.rect(20, yPos, 95, 32);
                doc.rect(115, yPos, 35, 8);
                doc.rect(150, yPos, 20, 8);
                doc.rect(170, yPos, 20, 8);

                doc.setFont('helvetica', 'bold');
                doc.text('Our Bank Details:', 25, yPos + 5);
                doc.text('Add : IGST @', 132, yPos + 5, { align: 'center' });
                doc.text('18%', 160, yPos + 5, { align: 'center' });
                doc.text(calculations.igst, 187, yPos + 5, { align: 'right' });

                yPos += 8;
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.setFont('helvetica', 'normal');
                doc.text(`Name : ${formData.bankName}`, 25, yPos + 5);
                doc.setFont('helvetica', 'bold');
                doc.text('Total Amount after Tax:', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.totalAfterTax, 187, yPos + 5, { align: 'right' });

                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.text(`A/c.No. ${formData.accountNo}`, 25, yPos + 5);

                yPos += 8;
                doc.text(`Bank Name: ${formData.bankBranch}`, 25, yPos + 5);

                yPos += 8;
                doc.rect(20, yPos, 95, 8);
                doc.rect(115, yPos, 55, 8);
                doc.rect(170, yPos, 20, 8);
                doc.text(`IFSC Code: ${formData.ifscCode}`, 25, yPos + 5);
                doc.setFont('helvetica', 'bold');
                doc.text('Net Amount Payable', 140, yPos + 5, { align: 'center' });
                doc.text(calculations.netAmount, 187, yPos + 5, { align: 'right' });

                // Amount in Words
                yPos += 15;
                doc.setFont('helvetica', 'normal');
                doc.text(`Rupees : ${calculations.amountInWords}`, 25, yPos);

                // Declaration and Signature
                yPos += 25;
                doc.rect(20, yPos, 120, 25);
                doc.rect(140, yPos, 50, 25);
                doc.setFont('helvetica', 'bold');
                doc.text('Subject to Hyderabad Jurisdiction Only', 25, yPos + 5);
                doc.text('Declaration:', 25, yPos + 10);
                doc.text(`For ${formData.companyName}`, 165, yPos + 5, { align: 'center' });
                doc.text('Authorised Signatory', 165, yPos + 15, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.text('We declare that this invoice shows the actual price of the', 25, yPos + 15);
                doc.text('goods described and that all particulars are true and correct.', 25, yPos + 20);

                doc.save(`tax-invoice-${formData.invoiceNo || 'new'}.pdf`);
            };

            const backToForm = () => {
                // Clear URL parameters and go back to form mode
                window.history.pushState({}, document.title, window.location.pathname);
                setMode('form');
            };

            // Get calculated values for display
            const calculations = calculateAmounts();

            if (mode === 'pdf') {
                return (
                    <div className="min-h-screen bg-gray-50 py-8">
                        <div className="max-w-4xl mx-auto px-4">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h1 className="text-2xl font-bold text-gray-900">Invoice PDF View</h1>
                                    <div className="space-x-4">
                                        <button
                                            onClick={downloadPDF}
                                            className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
                                        >
                                            Download PDF
                                        </button>
                                        <button
                                            onClick={backToForm}
                                            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                                        >
                                            Edit Invoice
                                        </button>
                                    </div>
                                </div>

                                <div className="printable-invoice bg-white border border-gray-300 p-6">
                                    <div className="invoice-preview text-xs">
                                        {/* Header */}
                                        <div className="text-center border border-black p-2 mb-1">
                                            <div className="font-bold text-lg">TAX INVOICE</div>
                                        </div>

                                        <div className="text-center border border-black p-2 mb-1">
                                            <div className="font-bold text-base">{formData.companyName}</div>
                                        </div>

                                        {/* Company Details */}
                                        <div className="mb-2 text-xs">
                                            <div>Address : {formData.address}</div>
                                            <div>Mobile No: {formData.mobile} ; e-mail: {formData.email}</div>
                                            <div>Our GSTN : {formData.gstn}</div>
                                            <div>Place of Service : {formData.placeOfService}</div>
                                            <div>State Code : {formData.stateCode}</div>
                                        </div>

                                        {/* Invoice and Customer Details */}
                                        <div className="grid grid-cols-12 border border-black text-xs">
                                            <div className="col-span-8 border-r border-black p-2">
                                                <div className="font-bold">Details of Receiver (Billed to)</div>
                                                <div className="mt-2">
                                                    <div>{formData.receiverName}</div>
                                                    <div>{formData.receiverAddress}</div>
                                                    <div>{formData.receiverCity}</div>
                                                    <div>{formData.receiverState}</div>
                                                    <div>Customers GST No. {formData.customerGST}</div>
                                                </div>
                                            </div>
                                            <div className="col-span-4">
                                                <div className="grid grid-cols-2 h-full">
                                                    <div className="border-r border-black p-2">
                                                        <div className="font-bold">Invoice No :</div>
                                                        <div>{formData.invoiceNo}</div>
                                                        <div className="font-bold mt-4">State Code</div>
                                                        <div>{formData.stateCode}</div>
                                                    </div>
                                                    <div className="p-2">
                                                        <div className="font-bold">Date :</div>
                                                        <div>{formData.date}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Items Table */}
                                        <div className="border border-black mt-2">
                                            <div className="grid grid-cols-12 border-b border-black bg-gray-100 p-1 font-bold text-xs">
                                                <div className="col-span-1 border-r border-black text-center">S.No</div>
                                                <div className="col-span-5 border-r border-black text-center">Description of Service</div>
                                                <div className="col-span-2 border-r border-black text-center">SAC Code</div>
                                                <div className="col-span-1 border-r border-black text-center">Qty M.tons</div>
                                                <div className="col-span-1 border-r border-black text-center">Price per M.ton ₹</div>
                                                <div className="col-span-2 text-center">Amount ₹</div>
                                            </div>
                                            {calculations.items.map((item, index) => (
                                                <div key={index} className="grid grid-cols-12 border-b border-black p-1 text-xs">
                                                    <div className="col-span-1 border-r border-black text-center">{index + 1}</div>
                                                    <div className="col-span-5 border-r border-black px-1">{item.description}</div>
                                                    <div className="col-span-2 border-r border-black text-center">{item.sacCode}</div>
                                                    <div className="col-span-1 border-r border-black text-center">{item.qty}</div>
                                                    <div className="col-span-1 border-r border-black text-center">{item.rate}</div>
                                                    <div className="col-span-2 text-right px-1">{item.amount}</div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Tax Summary */}
                                        <div className="grid grid-cols-12 border border-black mt-2">
                                            <div className="col-span-8 border-r border-black p-2">
                                                <div className="font-bold">Our Bank Details:</div>
                                                <div>Name : {formData.bankName}</div>
                                                <div>A/c.No. {formData.accountNo}</div>
                                                <div>Bank Name: {formData.bankBranch}</div>
                                                <div>IFSC Code: {formData.ifscCode}</div>
                                            </div>
                                            <div className="col-span-4">
                                                <div className="space-y-1 text-xs p-2">
                                                    <div className="grid grid-cols-3 border-b pb-1">
                                                        <div className="col-span-2 font-bold">Total Amount before Tax</div>
                                                        <div className="text-right">{calculations.totalBeforeTax}</div>
                                                    </div>
                                                    <div className="grid grid-cols-3 border-b pb-1">
                                                        <div>Add : IGST @</div>
                                                        <div className="text-center">18%</div>
                                                        <div className="text-right">{calculations.igst}</div>
                                                    </div>
                                                    <div className="grid grid-cols-3 border-b pb-1">
                                                        <div className="col-span-2 font-bold">Total Amount after Tax:</div>
                                                        <div className="text-right">{calculations.totalAfterTax}</div>
                                                    </div>
                                                    <div className="grid grid-cols-3 border-t pt-1">
                                                        <div className="col-span-2 font-bold">Net Amount Payable</div>
                                                        <div className="text-right">{calculations.netAmount}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Amount in Words */}
                                        <div className="text-xs mt-2 p-2 border border-black">
                                            <div>Rupees : {calculations.amountInWords}</div>
                                        </div>

                                        {/* Declaration and Signature */}
                                        <div className="grid grid-cols-12 border border-black mt-4">
                                            <div className="col-span-8 border-r border-black p-2">
                                                <div className="font-bold">Subject to Hyderabad Jurisdiction Only</div>
                                                <div className="font-bold mt-2">Declaration:</div>
                                                <div>We declare that this invoice shows the actual price of the goods described and that all particulars are true and correct.</div>
                                            </div>
                                            <div className="col-span-4 p-2 text-center">
                                                <div className="font-bold mt-2">For {formData.companyName}</div>
                                                <div className="font-bold italic mt-8">Authorised Signatory</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 py-8">
                    <div className="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h1 className="text-3xl font-bold text-gray-900 mb-8 text-center">Tax Invoice Generator</h1>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                {/* Form Section */}
                                <div className="space-y-6">
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-blue-900 mb-4">Company Details</h2>
                                        <div className="grid grid-cols-1 gap-4">
                                            <input
                                                type="text"
                                                name="companyName"
                                                placeholder="Company Name"
                                                value={formData.companyName}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                            />
                                            <textarea
                                                name="address"
                                                placeholder="Address"
                                                value={formData.address}
                                                onChange={handleInputChange}
                                                rows="3"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <input
                                                    type="text"
                                                    name="mobile"
                                                    placeholder="Mobile"
                                                    value={formData.mobile}
                                                    onChange={handleInputChange}
                                                    className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                                />
                                                <input
                                                    type="email"
                                                    name="email"
                                                    placeholder="Email"
                                                    value={formData.email}
                                                    onChange={handleInputChange}
                                                    className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <input
                                                    type="text"
                                                    name="gstn"
                                                    placeholder="GSTN"
                                                    value={formData.gstn}
                                                    onChange={handleInputChange}
                                                    className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                                />
                                                <input
                                                    type="text"
                                                    name="stateCode"
                                                    placeholder="State Code"
                                                    value={formData.stateCode}
                                                    onChange={handleInputChange}
                                                    className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-green-900 mb-4">Invoice Details</h2>
                                        <div className="grid grid-cols-2 gap-4">
                                            <input
                                                type="text"
                                                name="invoiceNo"
                                                placeholder="Invoice Number"
                                                value={formData.invoiceNo}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
                                            />
                                            <input
                                                type="text"
                                                name="date"
                                                placeholder="Date"
                                                value={formData.date}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-purple-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-purple-900 mb-4">Customer Details</h2>
                                        <div className="space-y-4">
                                            <input
                                                type="text"
                                                name="receiverName"
                                                placeholder="Customer Name"
                                                value={formData.receiverName}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                            />
                                            <input
                                                type="text"
                                                name="receiverAddress"
                                                placeholder="Address Line 1"
                                                value={formData.receiverAddress}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                            />
                                            <input
                                                type="text"
                                                name="receiverCity"
                                                placeholder="City"
                                                value={formData.receiverCity}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                            />
                                            <input
                                                type="text"
                                                name="customerGST"
                                                placeholder="Customer GST"
                                                value={formData.customerGST}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-yellow-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-yellow-900 mb-4">Items (Auto-calculated)</h2>
                                        {formData.items.map((item, index) => (
                                            <div key={index} className="grid grid-cols-12 gap-2 mb-3 items-center">
                                                <input
                                                    type="text"
                                                    placeholder="Description"
                                                    value={item.description}
                                                    onChange={(e) => handleInputChange(e, index, 'description')}
                                                    className="col-span-2 p-2 border border-gray-300 rounded text-sm focus:ring-yellow-500 focus:border-yellow-500"
                                                />
                                                <input
                                                    type="text"
                                                    placeholder="SAC Code"
                                                    value={item.sacCode}
                                                    onChange={(e) => handleInputChange(e, index, 'sacCode')}
                                                    className="col-span-2 p-2 border border-gray-300 rounded text-sm focus:ring-yellow-500 focus:border-yellow-500"
                                                />
                                                <input
                                                    type="number"
                                                    step="0.001"
                                                    placeholder="Qty"
                                                    value={item.qty}
                                                    onChange={(e) => handleInputChange(e, index, 'qty')}
                                                    className="col-span-2 p-2 border border-gray-300 rounded text-sm focus:ring-yellow-500 focus:border-yellow-500"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Rate"
                                                    value={item.rate}
                                                    onChange={(e) => handleInputChange(e, index, 'rate')}
                                                    className="col-span-2 p-2 border border-gray-300 rounded text-sm focus:ring-yellow-500 focus:border-yellow-500"
                                                />
                                                <div className="col-span-3 p-2 text-sm font-semibold text-center bg-gray-100 rounded overflow-x-auto">
                                                    {calculations.items[index]?.amount || '-'}
                                                </div>
                                                <button
                                                    onClick={() => removeItem(index)}
                                                    className="col-span-1 p-2 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                                >
                                                    ✕
                                                </button>
                                            </div>
                                        ))}
                                        <button
                                            onClick={addItem}
                                            className="w-full p-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
                                        >
                                            Add Item
                                        </button>
                                    </div>

                                    <div className="bg-orange-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-orange-900 mb-4">Calculated Totals</h2>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="p-3 bg-white rounded border">
                                                <label className="text-sm font-medium text-gray-600">Total Before Tax</label>
                                                <div className="text-lg font-bold text-gray-900">₹{calculations.totalBeforeTax}</div>
                                            </div>
                                            <div className="p-3 bg-white rounded border">
                                                <label className="text-sm font-medium text-gray-600">IGST @ 18%</label>
                                                <div className="text-lg font-bold text-gray-900">₹{calculations.igst}</div>
                                            </div>
                                            <div className="p-3 bg-white rounded border">
                                                <label className="text-sm font-medium text-gray-600">Total After Tax</label>
                                                <div className="text-lg font-bold text-gray-900">₹{calculations.totalAfterTax}</div>
                                            </div>
                                            <div className="p-3 bg-white rounded border">
                                                <label className="text-sm font-medium text-gray-600">Net Amount</label>
                                                <div className="text-lg font-bold text-gray-900">₹{calculations.netAmount}</div>
                                            </div>
                                        </div>
                                        <div className="mt-4 p-3 bg-white rounded border">
                                            <label className="text-sm font-medium text-gray-600">Amount in Words</label>
                                            <div className="text-sm font-bold text-gray-900">{calculations.amountInWords}</div>
                                        </div>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4">Bank Details</h2>
                                        <div className="space-y-4">
                                            <input
                                                type="text"
                                                name="bankName"
                                                placeholder="Bank Name"
                                                value={formData.bankName}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500"
                                            />
                                            <input
                                                type="text"
                                                name="accountNo"
                                                placeholder="Account Number"
                                                value={formData.accountNo}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500"
                                            />
                                            <input
                                                type="text"
                                                name="bankBranch"
                                                placeholder="Bank Branch"
                                                value={formData.bankBranch}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500"
                                            />
                                            <input
                                                type="text"
                                                name="ifscCode"
                                                placeholder="IFSC Code"
                                                value={formData.ifscCode}
                                                onChange={handleInputChange}
                                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500"
                                            />
                                        </div>
                                    </div>

                                    <button
                                        onClick={generatePDFWithURL}
                                        className="w-full bg-blue-600 text-white py-4 px-6 rounded-lg hover:bg-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold text-lg shadow-lg"
                                    >
                                        Generate PDF Invoice
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<InvoiceGenerator />, document.getElementById('root'));
    </script>
</body>

</html>